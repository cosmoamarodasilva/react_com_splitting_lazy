{"ast":null,"code":"/*\n * Jake JavaScript build tool\n * Copyright 2112 Matthew Eernisse (mde@fleegix.org)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n*/\nlet fs = require('fs');\n\nlet parseargs = require('./parseargs');\n\nlet utils = require('./utils');\n\nlet Program;\n\nlet usage = require('fs').readFileSync(`${__dirname}/../usage.txt`).toString();\n\nlet {\n  Task\n} = require('./task/task');\n\nfunction die(msg) {\n  console.log(msg);\n  process.stdout.write('', function () {\n    process.stderr.write('', function () {\n      process.exit();\n    });\n  });\n}\n\nlet preempts = {\n  version: function () {\n    die(jake.version);\n  },\n  help: function () {\n    die(usage);\n  }\n};\nlet AVAILABLE_OPTS = [{\n  full: 'jakefile',\n  abbr: 'f',\n  expectValue: true\n}, {\n  full: 'quiet',\n  abbr: 'q',\n  expectValue: false\n}, {\n  full: 'directory',\n  abbr: 'C',\n  expectValue: true\n}, {\n  full: 'always-make',\n  abbr: 'B',\n  expectValue: false\n}, {\n  full: 'tasks',\n  abbr: 'T',\n  expectValue: false,\n  allowValue: true\n}, // Alias t\n{\n  full: 'tasks',\n  abbr: 't',\n  expectValue: false,\n  allowValue: true\n}, // Alias ls\n{\n  full: 'tasks',\n  abbr: 'ls',\n  expectValue: false,\n  allowValue: true\n}, {\n  full: 'help',\n  abbr: 'h'\n}, {\n  full: 'version',\n  abbr: 'V'\n}, // Alias lowercase v\n{\n  full: 'version',\n  abbr: 'v'\n}, {\n  full: 'jakelibdir',\n  abbr: 'J',\n  expectValue: true\n}, {\n  full: 'allow-rejection',\n  abbr: 'ar',\n  expectValue: false\n}];\n\nProgram = function () {\n  this.availableOpts = AVAILABLE_OPTS;\n  this.opts = {};\n  this.taskNames = null;\n  this.taskArgs = null;\n  this.envVars = null;\n  this.die = die;\n};\n\nProgram.prototype = new function () {\n  this.handleErr = function (err) {\n    if (jake.listeners('error').length !== 0) {\n      jake.emit('error', err);\n      return;\n    }\n\n    if (jake.listeners('error').length) {\n      jake.emit('error', err);\n      return;\n    }\n\n    utils.logger.error('jake aborted.');\n\n    if (err.stack) {\n      utils.logger.error(err.stack);\n    } else {\n      utils.logger.error(err.message);\n    }\n\n    process.stdout.write('', function () {\n      process.stderr.write('', function () {\n        jake.errorCode = jake.errorCode || 1;\n        process.exit(jake.errorCode);\n      });\n    });\n  };\n\n  this.parseArgs = function (args) {\n    let result = new parseargs.Parser(this.availableOpts).parse(args);\n    this.setOpts(result.opts);\n    this.setTaskNames(result.taskNames);\n    this.setEnvVars(result.envVars);\n  };\n\n  this.setOpts = function (options) {\n    let opts = options || {};\n    Object.assign(this.opts, opts);\n  };\n\n  this.internalOpts = function (options) {\n    this.availableOpts = this.availableOpts.concat(options);\n  };\n\n  this.autocompletions = function (cur) {\n    let p;\n    let i;\n    let task;\n    let commonPrefix = '';\n    let matches = [];\n\n    for (p in jake.Task) {\n      task = jake.Task[p];\n\n      if ('fullName' in task && ( // if empty string, program converts to true\n      cur === true || task.fullName.indexOf(cur) === 0)) {\n        if (matches.length === 0) {\n          commonPrefix = task.fullName;\n        } else {\n          for (i = commonPrefix.length; i > -1; --i) {\n            commonPrefix = commonPrefix.substr(0, i);\n\n            if (task.fullName.indexOf(commonPrefix) === 0) {\n              break;\n            }\n          }\n        }\n\n        matches.push(task.fullName);\n      }\n    }\n\n    if (matches.length > 1 && commonPrefix === cur) {\n      matches.unshift('yes-space');\n    } else {\n      matches.unshift('no-space');\n    }\n\n    process.stdout.write(matches.join(' '));\n  };\n\n  this.setTaskNames = function (names) {\n    if (names && !Array.isArray(names)) {\n      throw new Error('Task names must be an array');\n    }\n\n    this.taskNames = names && names.length ? names : ['default'];\n  };\n\n  this.setEnvVars = function (vars) {\n    this.envVars = vars || null;\n  };\n\n  this.firstPreemptiveOption = function () {\n    let opts = this.opts;\n\n    for (let p in opts) {\n      if (preempts[p]) {\n        return preempts[p];\n      }\n    }\n\n    return false;\n  };\n\n  this.init = function (configuration) {\n    let self = this;\n    let config = configuration || {};\n\n    if (config.options) {\n      this.setOpts(config.options);\n    }\n\n    if (config.taskNames) {\n      this.setTaskNames(config.taskNames);\n    }\n\n    if (config.envVars) {\n      this.setEnvVars(config.envVars);\n    }\n\n    process.addListener('uncaughtException', function (err) {\n      self.handleErr(err);\n    });\n\n    if (!this.opts['allow-rejection']) {\n      process.addListener('unhandledRejection', (reason, promise) => {\n        utils.logger.error('Unhandled rejection at:', promise, 'reason:', reason);\n        self.handleErr(reason);\n      });\n    }\n\n    if (this.envVars) {\n      Object.assign(process.env, this.envVars);\n    }\n  };\n\n  this.run = function () {\n    let rootTask;\n    let taskNames;\n    let dirname;\n    let opts = this.opts;\n\n    if (opts.autocomplete) {\n      return this.autocompletions(opts['autocomplete-cur'], opts['autocomplete-prev']);\n    } // Run with `jake -T`, just show descriptions\n\n\n    if (opts.tasks) {\n      return jake.showAllTaskDescriptions(opts.tasks);\n    }\n\n    taskNames = this.taskNames;\n\n    if (!(Array.isArray(taskNames) && taskNames.length)) {\n      throw new Error('Please pass jake.runTasks an array of task-names');\n    } // Set working dir\n\n\n    dirname = opts.directory;\n\n    if (dirname) {\n      if (fs.existsSync(dirname) && fs.statSync(dirname).isDirectory()) {\n        process.chdir(dirname);\n      } else {\n        throw new Error(dirname + ' is not a valid directory path');\n      }\n    }\n\n    rootTask = task(Task.ROOT_TASK_NAME, taskNames, function () {});\n    rootTask._internal = true;\n    rootTask.once('complete', function () {\n      jake.emit('complete');\n    });\n    jake.emit('start');\n    rootTask.invoke();\n  };\n}();\nmodule.exports.Program = Program;","map":{"version":3,"sources":["C:/Users/anafe/OneDrive/Documentos/projeto_com_react2/src/backend/node/node_modules/jake/lib/program.js"],"names":["fs","require","parseargs","utils","Program","usage","readFileSync","__dirname","toString","Task","die","msg","console","log","process","stdout","write","stderr","exit","preempts","version","jake","help","AVAILABLE_OPTS","full","abbr","expectValue","allowValue","availableOpts","opts","taskNames","taskArgs","envVars","prototype","handleErr","err","listeners","length","emit","logger","error","stack","message","errorCode","parseArgs","args","result","Parser","parse","setOpts","setTaskNames","setEnvVars","options","Object","assign","internalOpts","concat","autocompletions","cur","p","i","task","commonPrefix","matches","fullName","indexOf","substr","push","unshift","join","names","Array","isArray","Error","vars","firstPreemptiveOption","init","configuration","self","config","addListener","reason","promise","env","run","rootTask","dirname","autocomplete","tasks","showAllTaskDescriptions","directory","existsSync","statSync","isDirectory","chdir","ROOT_TASK_NAME","_internal","once","invoke","module","exports"],"mappings":"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","sourcesContent":["/*\n * Jake JavaScript build tool\n * Copyright 2112 Matthew Eernisse (mde@fleegix.org)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n*/\n\nlet fs = require('fs');\nlet parseargs = require('./parseargs');\nlet utils = require('./utils');\nlet Program;\nlet usage = require('fs').readFileSync(`${__dirname}/../usage.txt`).toString();\nlet { Task } = require('./task/task');\n\nfunction die(msg) {\n  console.log(msg);\n  process.stdout.write('', function () {\n    process.stderr.write('', function () {\n      process.exit();\n    });\n  });\n}\n\nlet preempts = {\n  version: function () {\n    die(jake.version);\n  },\n  help: function () {\n    die(usage);\n  }\n};\n\nlet AVAILABLE_OPTS = [\n  { full: 'jakefile',\n    abbr: 'f',\n    expectValue: true\n  },\n  { full: 'quiet',\n    abbr: 'q',\n    expectValue: false\n  },\n  { full: 'directory',\n    abbr: 'C',\n    expectValue: true\n  },\n  { full: 'always-make',\n    abbr: 'B',\n    expectValue: false\n  },\n  { full: 'tasks',\n    abbr: 'T',\n    expectValue: false,\n    allowValue: true\n  },\n  // Alias t\n  { full: 'tasks',\n    abbr: 't',\n    expectValue: false,\n    allowValue: true\n  },\n  // Alias ls\n  { full: 'tasks',\n    abbr: 'ls',\n    expectValue: false,\n    allowValue: true\n  },\n  { full: 'help',\n    abbr: 'h',\n  },\n  { full: 'version',\n    abbr: 'V',\n  },\n  // Alias lowercase v\n  { full: 'version',\n    abbr: 'v',\n  },\n  { full: 'jakelibdir',\n    abbr: 'J',\n    expectValue: true\n  },\n  { full: 'allow-rejection',\n    abbr: 'ar',\n    expectValue: false\n  }\n];\n\nProgram = function () {\n  this.availableOpts = AVAILABLE_OPTS;\n  this.opts = {};\n  this.taskNames = null;\n  this.taskArgs = null;\n  this.envVars = null;\n  this.die = die;\n};\n\nProgram.prototype = new (function () {\n\n  this.handleErr = function (err) {\n    if (jake.listeners('error').length !== 0) {\n      jake.emit('error', err);\n      return;\n    }\n\n    if (jake.listeners('error').length) {\n      jake.emit('error', err);\n      return;\n    }\n\n    utils.logger.error('jake aborted.');\n    if (err.stack) {\n      utils.logger.error(err.stack);\n    }\n    else {\n      utils.logger.error(err.message);\n    }\n\n    process.stdout.write('', function () {\n      process.stderr.write('', function () {\n        jake.errorCode = jake.errorCode || 1;\n        process.exit(jake.errorCode);\n      });\n    });\n  };\n\n  this.parseArgs = function (args) {\n    let result = (new parseargs.Parser(this.availableOpts)).parse(args);\n    this.setOpts(result.opts);\n    this.setTaskNames(result.taskNames);\n    this.setEnvVars(result.envVars);\n  };\n\n  this.setOpts = function (options) {\n    let opts = options || {};\n    Object.assign(this.opts, opts);\n  };\n\n  this.internalOpts = function (options) {\n    this.availableOpts = this.availableOpts.concat(options);\n  };\n\n  this.autocompletions = function (cur) {\n    let p; let i; let task;\n    let commonPrefix = '';\n    let matches = [];\n\n    for (p in jake.Task) {\n      task = jake.Task[p];\n      if (\n        'fullName' in task\n          && (\n            // if empty string, program converts to true\n            cur === true ||\n            task.fullName.indexOf(cur) === 0\n          )\n      ) {\n        if (matches.length === 0) {\n          commonPrefix = task.fullName;\n        }\n        else {\n          for (i = commonPrefix.length; i > -1; --i) {\n            commonPrefix = commonPrefix.substr(0, i);\n            if (task.fullName.indexOf(commonPrefix) === 0) {\n              break;\n            }\n          }\n        }\n        matches.push(task.fullName);\n      }\n    }\n\n    if (matches.length > 1 && commonPrefix === cur) {\n      matches.unshift('yes-space');\n    }\n    else {\n      matches.unshift('no-space');\n    }\n\n    process.stdout.write(matches.join(' '));\n  };\n\n  this.setTaskNames = function (names) {\n    if (names && !Array.isArray(names)) {\n      throw new Error('Task names must be an array');\n    }\n    this.taskNames = (names && names.length) ? names : ['default'];\n  };\n\n  this.setEnvVars = function (vars) {\n    this.envVars = vars || null;\n  };\n\n  this.firstPreemptiveOption = function () {\n    let opts = this.opts;\n    for (let p in opts) {\n      if (preempts[p]) {\n        return preempts[p];\n      }\n    }\n    return false;\n  };\n\n  this.init = function (configuration) {\n    let self = this;\n    let config = configuration || {};\n    if (config.options) {\n      this.setOpts(config.options);\n    }\n    if (config.taskNames) {\n      this.setTaskNames(config.taskNames);\n    }\n    if (config.envVars) {\n      this.setEnvVars(config.envVars);\n    }\n    process.addListener('uncaughtException', function (err) {\n      self.handleErr(err);\n    });\n    if (!this.opts['allow-rejection']) {\n      process.addListener('unhandledRejection', (reason, promise) => {\n        utils.logger.error('Unhandled rejection at:', promise, 'reason:', reason);\n        self.handleErr(reason);\n      });\n    }\n    if (this.envVars) {\n      Object.assign(process.env, this.envVars);\n    }\n  };\n\n  this.run = function () {\n    let rootTask;\n    let taskNames;\n    let dirname;\n    let opts = this.opts;\n\n    if (opts.autocomplete) {\n      return this.autocompletions(opts['autocomplete-cur'], opts['autocomplete-prev']);\n    }\n    // Run with `jake -T`, just show descriptions\n    if (opts.tasks) {\n      return jake.showAllTaskDescriptions(opts.tasks);\n    }\n\n    taskNames = this.taskNames;\n    if (!(Array.isArray(taskNames) && taskNames.length)) {\n      throw new Error('Please pass jake.runTasks an array of task-names');\n    }\n\n    // Set working dir\n    dirname = opts.directory;\n    if (dirname) {\n      if (fs.existsSync(dirname) &&\n        fs.statSync(dirname).isDirectory()) {\n        process.chdir(dirname);\n      }\n      else {\n        throw new Error(dirname + ' is not a valid directory path');\n      }\n    }\n\n    rootTask = task(Task.ROOT_TASK_NAME, taskNames, function () {});\n    rootTask._internal = true;\n\n    rootTask.once('complete', function () {\n      jake.emit('complete');\n    });\n    jake.emit('start');\n    rootTask.invoke();\n  };\n\n})();\n\nmodule.exports.Program = Program;\n"]},"metadata":{},"sourceType":"module"}